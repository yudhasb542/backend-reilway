<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mistika Nusantara Store</title>
  <style>
    @font-face {
      font-family: 'Aprila';
      src: url('https://fonts.cdnfonts.com/s/14716/Aprila%20Regular.woff') format('woff');
    }

    body {
      font-family: 'Aprila', sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
    }

    #book-container {
      display: grid;
      gap: 30px;
      padding: 20px;
      justify-content: center;
    }

    .book-item {
      background: #bdbdbd;
      border-radius: 22px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      padding: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 250px;
      margin: 0 auto;
    }

    .book-item img {
      width: 100%;
      height: auto;
      border-radius: 10px;
      object-fit: cover;
    }

    h3 {
      margin: 10px 0 5px;
      font-size: 1.1rem;
      color: #8b0000;
      font-weight: bold;
      text-align: center;
    }

    .book-item p {
      margin: 5px 0;
      font-weight: bold;
      color: #111;
      font-size: 1rem;
    }

    .book-item .desc {
      font-weight: bold;
      color: #111;
      font-size: 0.9rem;
      text-align: center;
      margin: 5px 0 10px;
    }

    button {
      margin: 5px;
      padding: 10px 20px;
      border: none;
      border-radius: 999px;
      background: #8b0000;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background: #a00000;
      transform: translateY(-1px);
    }

    #keranjang-widget {
      position: fixed;
      top: 10px;
      right: 10px;
      background: #8b0000;
      color: #fff;
      padding: 10px 15px;
      border-radius: 20px;
      cursor: pointer;
      z-index: 100;
      font-weight: bold;
    }

    /* Popup */
    .popup-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .popup-content {
      background: #fff;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      border-radius: 10px;
    }

    .checkout-card {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }

    .checkout-field {
      display: flex;
      align-items: center;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 5px 10px;
      background: #f5f5f5;
    }

    .checkout-field span {
      margin-right: 8px;
      color: #25D366;
      font-size: 1.4em;
    }

    .checkout-field input {
      border: none;
      background: transparent;
      outline: none;
      flex: 1;
      font-family: 'Aprila', sans-serif;
      font-size: 1em;
    }

    .note-email {
      font-size: 0.85rem;
      color: #8b0000;
      margin-top: -5px;
      margin-bottom: 10px;
    }

    @media screen and (max-width: 600px) {
      #book-container {
        grid-template-columns: 1fr;
      }
    }

    @media screen and (min-width: 601px) and (max-width: 900px) {
      #book-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media screen and (min-width: 901px) and (max-width: 1199px) {
      #book-container {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    @media screen and (min-width: 1200px) {
      #book-container {
        grid-template-columns: repeat(6, 1fr);
      }
    }
  </style>
</head>
<body>

  <div id="keranjang-widget" onclick="tampilkanPopupKeranjang()">
    üõí <span id="jumlah-buku">0</span> Buku - Rp <span id="total-harga">0</span>
  </div>

  <div id="book-container">Memuat buku...</div>

  <!-- Popup Checkout -->
  <div id="popup-checkout" class="popup-overlay">
    <div class="popup-content">
      <h3>Checkout Buku</h3>
      <div id="popup-daftar-buku"></div>
      <p><strong>Total:</strong> Rp <span id="popup-total">0</span></p>
      <hr>

      <div class="checkout-card">
        <label>Nama:</label>
        <div class="checkout-field">
          <span>üë§</span>
          <input type="text" id="input-nama" placeholder="Nama lengkap" required>
        </div>

        <label>Email:</label>
        <div class="checkout-field">
          <span>‚úâÔ∏è</span>
          <input type="email" id="input-email" placeholder="email@domain.com" required>
        </div>
        <div class="note-email">Pastikan email benar karena file akan dikirim ke email ini.</div>

        <label>Nomor WhatsApp:</label>
        <div class="checkout-field">
          <span>üì±</span>
          <input type="text" id="input-wa" placeholder="+628xxxxxxxxxx" required>
        </div>
      </div>

      <div style="display:flex; gap:10px; margin-top: 10px;">
        <button onclick="submitPembayaran()">Kirim Pembayaran</button>
        <button onclick="tutupPopup()">Tutup</button>
      </div>
    </div>
  </div>

<script>
  async function loadBooks() {
    const response = await fetch('https://raw.githubusercontent.com/yudhasb542/data-buku/main/buku.json');
    const books = await response.json();

    const container = document.getElementById('book-container');
    container.innerHTML = '';

    books.forEach(book => {
      const item = document.createElement('div');
      item.className = 'book-item';
      item.innerHTML = `
        <img src="${book.preview}" alt="Preview ${book.judul}" />
        <p>Rp ${book.harga.toLocaleString()}</p>
        <h3>${book.judul}</h3>
        <div class="desc">${book.deskripsi || 'Deskripsi tidak tersedia.'}</div>
        <div style="display:flex; gap:10px; justify-content:center;">
          <button onclick="tambahKeKeranjang('${book.id}')">üõí Keranjang</button>
          <button onclick="beliSekarang('${book.id}')">Beli Sekarang</button>
        </div>
      `;
      container.appendChild(item);
    });

    updateWidgetKeranjang();
  }

  function tambahKeKeranjang(id) {
    let keranjang = JSON.parse(localStorage.getItem('keranjang')) || [];
    if (!keranjang.includes(id)) keranjang.push(id);
    localStorage.setItem('keranjang', JSON.stringify(keranjang));
    updateWidgetKeranjang();
  }

  function beliSekarang(id) {
    tambahKeKeranjang(id);
    tampilkanPopupKeranjang();
  }

  function updateWidgetKeranjang() {
    const keranjang = JSON.parse(localStorage.getItem('keranjang')) || [];
    const jumlah = keranjang.length;
    let total = 0;
    fetch('https://raw.githubusercontent.com/yudhasb542/data-buku/main/buku.json')
      .then(res => res.json())
      .then(data => {
        keranjang.forEach(id => {
          const buku = data.find(b => b.id === id);
          if (buku) total += buku.harga;
        });
        document.getElementById('jumlah-buku').textContent = jumlah;
        document.getElementById('total-harga').textContent = total.toLocaleString();
      });
  }

  function tampilkanPopupKeranjang() {
    const keranjang = JSON.parse(localStorage.getItem('keranjang')) || [];
    const daftar = document.getElementById('popup-daftar-buku');
    const totalSpan = document.getElementById('popup-total');

    fetch('https://raw.githubusercontent.com/yudhasb542/data-buku/main/buku.json')
      .then(res => res.json())
      .then(data => {
        daftar.innerHTML = '';
        let total = 0;
        keranjang.forEach(id => {
          const buku = data.find(b => b.id === id);
          if (buku) {
            total += buku.harga;
            daftar.innerHTML += `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <span>${buku.judul} - Rp ${buku.harga.toLocaleString()}</span>
              <button onclick="hapusDariKeranjang('${buku.id}')" style="background:#ccc; color:#000; border-radius:10px; padding:5px 10px;">Hapus</button>
            </div>
            `;
          }
        });
        totalSpan.textContent = total.toLocaleString();
        document.getElementById('popup-checkout').style.display = 'flex';
      });
  }

  function hapusDariKeranjang(id) {
    let keranjang = JSON.parse(localStorage.getItem('keranjang')) || [];
    keranjang = keranjang.filter(item => item !== id);
    localStorage.setItem('keranjang', JSON.stringify(keranjang));
    updateWidgetKeranjang();
    tampilkanPopupKeranjang();
  }

  function tutupPopup() {
    document.getElementById('popup-checkout').style.display = 'none';
  }

  function submitPembayaran() {
    alert("Fitur pembayaran akan diaktifkan setelah integrasi Tripay & Render.");
  }

  window.addEventListener('DOMContentLoaded', loadBooks);
  window.addEventListener('storage', updateWidgetKeranjang);
</script>

</body>
</html>
